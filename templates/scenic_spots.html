{% extends 'base.html' %}
{% load static %}

{% block content %}
    <!-- 搜索框区域 -->
    <div class="container my-4">
        <div class="row">
            <div class="col-12">
                <form method="get" action="{% url 'ticket:scenic_spots' %}" class="d-flex justify-content-center">
                    <div class="input-group" style="max-width: 800px;">
                        <label for="search" class="visually-hidden">搜索景点/城市</label>
                        <input 
                            type="text" 
                            class="form-control form-control-lg" 
                            id="search"
                            placeholder="请输入景点/城市名" 
                            name="search" 
                            value="{{ search_keyword }}"
                        >
                        <button class="btn btn-primary btn-lg" type="submit">
                            <i class="bi bi-search"></i> 搜索
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 筛选和内容区域 -->
    <div class="container">
        <div class="row">
            <!-- 左侧筛选栏 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <!-- 按地区筛选 -->
                        <div class="mb-5">
                            <h5 class="mb-3">按地区筛选</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <a 
                                        href="{% url 'ticket:scenic_spots' %}?{% if search_keyword %}search={{ search_keyword }}&{% endif %}{% if category_filter %}category={{ category_filter }}{% endif %}" 
                                        class="text-decoration-none text-dark {% if not region_filter %}fw-bold{% endif %}"
                                    >
                                        全部地区
                                    </a>
                                </li>

                                {% for region in regions %}
                                <li class="mb-2">
                                    <a 
                                        href="{% url 'ticket:scenic_spots' %}?{% if search_keyword %}search={{ search_keyword }}&{% endif %}region={{ region }}{% if category_filter %}&category={{ category_filter }}{% endif %}" 
                                        class="text-decoration-none text-dark {% if region_filter == region %}fw-bold{% endif %}"
                                    >
                                        {{ region }}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>

                        <!-- 按分类筛选 -->
                        <div>
                            <h5 class="mb-3">按分类筛选</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <a 
                                        href="{% url 'ticket:scenic_spots' %}?{% if search_keyword %}search={{ search_keyword }}&{% endif %}{% if region_filter %}region={{ region_filter }}{% endif %}" 
                                        class="text-decoration-none text-dark {% if not category_filter %}fw-bold{% endif %}"
                                    >
                                        全部分类
                                    </a>
                                </li>
                                {% for category in categories %}
                                <li class="mb-2">
                                    <a 
                                        href="{% url 'ticket:scenic_spots' %}?{% if search_keyword %}search={{ search_keyword }}&{% endif %}{% if region_filter %}region={{ region_filter }}&{% endif %}category={{ category }}" 
                                        class="text-decoration-none text-dark {% if category_filter == category %}fw-bold{% endif %}"
                                    >
                                        {{ category }}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 主内容区 - 景点卡片 -->
            <div class="col-md-9">
                <div class="row g-4">
                    {% for spot in spots %}
                    <div class="col-md-4">
                        <div class="card h-100 d-flex flex-column shadow-sm border-0">
                            <!-- 景点封面图 -->
                            <div class="position-relative">
                                {% if spot.image %}
                                <img 
                                    src="{{ spot.image.url }}" 
                                    class="card-img-top" 
                                    alt="{{ spot.name }}" 
                                    style="height: 200px; object-fit: cover;"
                                >
                                {% else %}
                                <div class="card-img-top d-flex justify-content-center align-items-center"
                                     style="height: 200px; background-color: #f8f9fa;">
                                    <span class="text-muted">暂无图片</span>
                                </div>
                                {% endif %}
                                {% if spot.is_hot %}
                                <span class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 m-2 rounded">
                                    热门
                                </span>
                                {% endif %}
                            </div>
                            
                            <!-- 景点 -->
                            <div class="card-body flex-grow-1">
                                <!-- 景点名称 -->
                                <h5 class="card-title mb-2">{{ spot.name }}</h5>
                                
                                <!-- 景点位置 -->
                                <p class="card-text text-muted small mb-3">
                                    <i class="bi bi-geo-alt"></i> {{ spot.region.name|default:"未设置" }}
                                </p>
                                
                                <!-- 景点标签 -->
                                <div class="mb-3">
                                    {% for tag in spot.tags_list %}
                                    <span class="badge bg-light text-dark me-1 mb-1">
                                        {{ tag }}
                                    </span>
                                    {% endfor %}
                                </div>
                                
                                <!-- 价格显示 -->
                                <p class="card-text text-danger fs-5 mb-3">¥{{ spot.price }}</p>
                            </div>
                            
                            <!-- 查看详情按钮 -->
                            <div class="card-footer bg-white border-top-0 pb-4 px-4">
                                <a 
                                    href="{% url 'ticket:scenic_spot_detail' spot_id=spot.id %}" 
                                    class="btn btn-primary w-100"
                                >
                                    查看详情
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <!-- 无结果提示 -->
                    <div class="col-12 text-center py-5">
                        <div class="mb-3">
                            <i class="bi bi-search text-muted" style="font-size: 48px;"></i>
                        </div>
                        <h5 class="text-muted">暂无符合条件的景点</h5>
                        <p class="text-muted">请尝试调整搜索条件</p>
                        <a href="{% url 'ticket:scenic_spots' %}" class="btn btn-primary mt-2">
                            重置筛选条件
                        </a>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- 分页导航 -->
                {% if spots.has_other_pages %}
                <div class="mt-5 d-flex justify-content-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            <!-- 上一页 -->
                            {% if spots.has_previous %}
                            <li class="page-item">
                                <a class="page-link" 
                                   href="?page={{ spots.previous_page_number }}{% if search_keyword %}&search={{ search_keyword }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&laquo;</a>
                            </li>
                            {% endif %}
                            
                            <!-- 页码 -->
                            {% for i in spots.paginator.page_range %}
                                {% if spots.number == i %}
                                <li class="page-item active" aria-current="page">
                                    <span class="page-link">{{ i }}</span>
                                </li>
                                {% else %}
                                <li class="page-item">
                                    <a class="page-link" 
                                       href="?page={{ i }}{% if search_keyword %}&search={{ search_keyword }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">
                                        {{ i }}
                                    </a>
                                </li>
                                {% endif %}
                            {% endfor %}
                            
                            <!-- 下一页 -->
                            {% if spots.has_next %}
                            <li class="page-item">
                                <a class="page-link" 
                                   href="?page={{ spots.next_page_number }}{% if search_keyword %}&search={{ search_keyword }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}"
                                   aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&raquo;</a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}