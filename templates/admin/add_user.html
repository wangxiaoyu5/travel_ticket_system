{% extends 'admin/base.html' %}

{% block content %}
    <div class="card">
        <div class="card-header">
            <h3>新增用户</h3>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="username" class="form-label">用户名</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">邮箱</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="password" class="form-label">密码</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="confirm_password" class="form-label">确认密码</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">用户角色</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="role" id="role_visitor" value="0">
                        <label class="form-check-label" for="role_visitor">
                            游客
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="role" id="role_scenic_admin" value="1" checked>
                        <label class="form-check-label" for="role_scenic_admin">
                            景点管理员
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="role" id="role_platform_admin" value="2">
                        <label class="form-check-label" for="role_platform_admin">
                            管理员
                        </label>
                    </div>
                </div>
                
                <div class="mb-3" id="scenic_selector">
                    <label for="scenic_spot" class="form-label">景点</label>
                    <select class="form-select" id="scenic_spot" name="scenic_spot">
                        <option value="">请选择景点</option>
                        <!-- 动态从数据库获取景点 -->
                        {% for scenic_spot in scenic_spots %}
                            <option value="{{ scenic_spot.id }}">{{ scenic_spot.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="d-flex gap-2 justify-content-end">
                    <a href="{% url 'ticket:admin_user_list' %}" class="btn btn-secondary">取消</a>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // 角色选择切换时，显示/隐藏景点选择器
        document.querySelectorAll('input[name="role"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const scenicSelector = document.getElementById('scenic_selector');
                if (this.value === '1') {
                    scenicSelector.style.display = 'block';
                } else {
                    scenicSelector.style.display = 'none';
                }
            });
        });
    </script>
{% endblock content %}